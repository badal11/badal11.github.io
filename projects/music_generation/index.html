<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Automated Musical Tune Generation using char RNN | Badal Tripathi</title> <meta name="author" content="Badal Tripathi"> <meta name="description" content="Automated composition of abc notation using char RNN that can be played by using inbuilt music library or external library"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://badal11.github.io/projects/music_generation/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Badal </span>Tripathi</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Automated Musical Tune Generation using char RNN</h1> <p class="post-description">Automated composition of abc notation using char RNN that can be played by using inbuilt music library or external library</p> </header> <article> <h2 id="demo-video"><a href="https://youtu.be/9OP5QJuB0w4" rel="external nofollow noopener" target="_blank">Demo video</a></h2> <h2 id="code"><a href="https://github.com/badal11/Musical_tune_composition" rel="external nofollow noopener" target="_blank">Code</a></h2> <h2 id="objectives">Objectives</h2> <p>-To create an automated musical tune prediction model that takes arbitary notes as input and predicts a sequence of musical notes</p> <p>-To develop an abc notation media player that can transform the converted note sequence into beautiful musical notes</p> <h2 id="music-and-its-representation">Music and it’s representation</h2> <p>A musical tune is a combination of sounds in time through the elements of melody, harmony, rhythm, and timbre. Music, like language, is a method of communication in which a series of notes can convey a variety of emotions. One important point to remember is that music must be both expressive and precise. Classical music, for example, is noted for its careful structure and emotional impact. Beginners find it difficult to compose musical tunes because they must first learn the “language” of music, such as time signatures and how to keep unit beats steady throughout a song while introducing creative uniqueness. We investigate if deep learning can be used to model this dynamic musical structure and effects. Nowadays, the music generation is quite crucial. It has a wide range of applications. Musicians and artists build on the machine’s output to create their creative work. Software-generated music or art is sometimes marketed by the companies or individuals that created it. They can be licensed to businesses and retailers for use in advertising, retail music, and so forth.</p> <h2 id="abc-notation">ABC notation</h2> <p>It uses alphanumeric Character to represent music. ABC notation is a simple but powerful ASCII musical notation format. ABC notation consists of 2 parts: first metadata and second actual music representation. Metadata: Contains the Title(T), Note length(L), Key and Clef(K) and so on. But most important as it determines the beat length of music.</p> <p>Music: Contain information about actual music.</p> <p><img src="https://user-images.githubusercontent.com/67474080/169774597-fdb9e6c5-af3f-4a40-b303-b0c0d9e532cb.png" alt="abc"></p> <h2 id="midi-format">Midi Format</h2> <p><img src="https://user-images.githubusercontent.com/67474080/169775222-bd3d10ee-3b9c-43ab-9b84-bea3a1d99cf3.png" alt="midi format"></p> <p>IT Uses Cord name, key and beats to represent music</p> <p>Image</p> <h2 id="sheet-music">Sheet Music</h2> <p><img src="https://user-images.githubusercontent.com/67474080/169775262-227390d2-8f12-44f3-9b71-8c4c9d7c2951.png" alt="sheet music"></p> <p>Sheet music is a type of musical notation that is handwritten or printed and includes musical symbols to describe the pitches, rhythms, and chords of a song or instrumental musical composition.</p> <h2 id="why-abc-notation">Why abc notation?</h2> <p>Music, as we know it, is continuous in formats such as mp3, midi, wav, and so on, and for an artificially intelligent agent to learn from it, it must first master intricate polyphonic structures in music. The entire syntax, grammar, and logic of music make it difficult to build an artificial network because it has so many parameters like amplitude, pitch, timing, and so on. How does ABC notation help to solve this problem? Music is made using different notes with specific timing for each note. A beautiful melody can be made using such nodes from different instruments superimposing on themselves. Single musical instruments like piano, Guitar, Violin, and bass can be represented using sheet music. Contrary to other formats sheet music is a discrete form of musical representation. But several assumptions like common time (4/4-time signature), key of G, and so on are taken into consideration. And thus, ABC notation maps each symbol from sheet music. ABC notation has strings(A-G). and numerals to represent music. Thus, music is represented in sequential form like the sequence of DNA. This narrow band of string in sequential form is used to train the ANN.</p> <h2 id="dataset-preparation">Dataset Preparation</h2> <p>As bulk music ABC format data is not available in a single source, we’ve collected data from multiple sources using web scraping. Numbers and special characters, as well as letter notations from A to G, are utilized to represent the specified notes in the ABC notation representation of the dataset. Each letter corresponds to a note in the classical scale, such as Do, Re, or MI. Other units are utilized as extra information in addition to the notes that make up the melody, such as the reference number, composer, origin, note length, tempo, rhythm key, ornament, and so on. The characteristics of our data collection are made up of each of these values. Below is a sample example of music written in ABC notation from the dataset.</p> <p>Tools used for Web Scraping:<br> BeautifulSoup<br> Requests</p> <p>The websites that were used for data collections are:<br> https://abcnotation.com/browseTunes,<br> http://roaringjelly.org<br> http://www.folktunefinder.com</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">folktune.txt</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">''</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="c1">#from page1 to page10
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://www.folktunefinder.com/tunes?features=&amp;page=</span><span class="sh">'</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">soup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">div</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">div</span><span class="sh">"</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span> <span class="sh">"</span><span class="s">col-md-9</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">tunes</span> <span class="o">=</span> <span class="n">div</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">ul</span><span class="sh">'</span><span class="p">).</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">"</span><span class="s">li</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tune</span> <span class="ow">in</span> <span class="n">tunes</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">tune</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>

        <span class="n">site</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.folktunefinder.com</span><span class="sh">'</span><span class="o">+</span><span class="n">tune</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="sh">"</span><span class="s">href</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">sitePage</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
        <span class="n">siteSoup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">sitePage</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">folktune.txt</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">siteSoup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">pre</span><span class="sh">'</span><span class="p">).</span><span class="n">string</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">'</span><span class="se">\n\n\n\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="n">requests</span>

<span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">roaringdata.txt</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">''</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://roaringjelly.org/~jc/cgi/abc/find.cgi?P=.*&amp;find=FIND&amp;m=title&amp;W=wide&amp;scale=0.65&amp;limit=160&amp;thresh=5&amp;fmt=single&amp;V=1&amp;Tsel=tune&amp;Nsel=0</span><span class="sh">'</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="n">text</span><span class="p">,</span><span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>

<span class="n">form</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">form</span><span class="sh">"</span><span class="p">,</span> <span class="n">class_</span> <span class="o">=</span> <span class="sh">"</span><span class="s">match</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">form</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">table</span><span class="sh">'</span><span class="p">,</span> <span class="n">class_</span> <span class="o">=</span> <span class="sh">'</span><span class="s">match</span><span class="sh">'</span><span class="p">):</span>
    <span class="n">lengthOfTable</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">table</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">tr</span><span class="sh">'</span><span class="p">))</span>

    <span class="n">checkTitle</span> <span class="o">=</span><span class="sh">''</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sh">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">lengthOfTable</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c1">#final range = lengthOfTable-1
</span>        <span class="n">data</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">tr</span><span class="sh">'</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">td</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">string</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">title</span>  <span class="o">+</span> <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>


        <span class="n">urlStringConcat</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://roaringjelly.org/~jc/cgi/abc/get.cgi?F=ABC&amp;U=</span><span class="sh">'</span>
        <span class="n">abcUrl</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">td</span><span class="sh">'</span><span class="p">)[</span><span class="mi">4</span><span class="p">].</span><span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)[</span><span class="sh">"</span><span class="s">href</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">abcUrl</span> <span class="o">=</span> <span class="n">abcUrl</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">U=</span><span class="sh">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">finalUrl</span> <span class="o">=</span> <span class="n">urlStringConcat</span> <span class="o">+</span> <span class="n">abcUrl</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">finalUrl</span> <span class="o">+</span><span class="sh">'</span><span class="se">\n\n\n\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">td</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">string</span>
        <span class="n">abcPage</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">finalUrl</span><span class="p">)</span>
        <span class="n">abcSoup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">abcPage</span><span class="p">.</span><span class="n">text</span><span class="p">,</span><span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>

        <span class="n">abc</span> <span class="o">=</span> <span class="n">abcSoup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">pre</span><span class="sh">"</span><span class="p">).</span><span class="n">string</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">roaringdata.txt</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">abc</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">'</span><span class="se">\n\n\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="c1"># print(abc)
</span>
<span class="c1"># parsing all tables
# from each table url is extracted
# this url is used to get abc format data
# file writting
# Same title data is not implemented
</span></code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>


<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://abcnotation.com/browseTunes</span><span class="sh">'</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">table</span><span class="sh">"</span><span class="p">,</span> <span class="n">class_</span> <span class="o">=</span><span class="sh">"</span><span class="s">width100pc table-bordered</span><span class="sh">"</span><span class="p">)</span>
<span class="n">tableRows</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">tr</span><span class="sh">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">#should be iterated to all td
</span><span class="k">for</span> <span class="n">tableData</span> <span class="ow">in</span> <span class="n">tableRows</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">td</span><span class="sh">'</span><span class="p">):</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">firstLink</span> <span class="ow">in</span> <span class="n">tableData</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">abcWebsite</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://abcnotation.com/</span><span class="sh">'</span>
            <span class="n">firstLink</span> <span class="o">=</span>  <span class="n">abcWebsite</span> <span class="o">+</span> <span class="n">firstLink</span><span class="p">[</span><span class="sh">'</span><span class="s">href</span><span class="sh">'</span><span class="p">]</span>

            <span class="n">secondPage</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">firstLink</span><span class="p">)</span>
            <span class="n">secondSoup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">secondPage</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>

            <span class="n">checkString</span> <span class="o">=</span> <span class="sh">''</span>

            <span class="n">secondSoup</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="sh">"</span><span class="s">href</span><span class="sh">"</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">secondSoup</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">i</span><span class="p">[</span><span class="sh">"</span><span class="s">href</span><span class="sh">"</span><span class="p">]</span>
                    <span class="nf">if</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">string</span> <span class="o">!=</span> <span class="n">checkString</span><span class="p">):</span>
                        <span class="c1"># # print(i['href'])
</span>                        <span class="c1"># print(i.string+'\n')
</span>                        <span class="n">checkString</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">string</span>
                        <span class="n">thirdLink</span> <span class="o">=</span> <span class="n">abcWebsite</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="sh">'</span><span class="s">href</span><span class="sh">'</span><span class="p">]</span>
                        <span class="c1">#print(thirdLink)
</span>                        <span class="nf">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
                        <span class="n">counter</span> <span class="o">+=</span><span class="mi">1</span>

                        <span class="n">thirdPage</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">thirdLink</span><span class="p">)</span>
                        <span class="n">thirdSoup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">thirdPage</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>
                        <span class="c1"># # print(thirdSoup.find('pre'))
</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">datafromABC.txt</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span>
                        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">thirdSoup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">'</span><span class="s">pre</span><span class="sh">'</span><span class="p">).</span><span class="n">string</span><span class="p">)</span>
                        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">'</span><span class="se">\n\n\n\n</span><span class="sh">'</span><span class="p">)</span>
                        <span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
</code></pre></div></div> <h2 id="data-cleaning">Data cleaning</h2> <p>Data cleaning is an important task. Uncleaned data produces more inaccuracy in the result. It helps in detecting, removing and correcting the incomplete, irrelevant, corrupt or inaccurate part of data from a dataset. Example of a cleaned sample data</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>X:111
T:11. DROPS OF BRANDY (32 bar polka)
T:Spokes's Tune/Vic's No. 2
M:2/4
L:1/8
K:D
d/2e/2|\
fd ec|dc/2B/2 AG|FA dF|EA Ad/2e/2|\
fd ec|dc/2B/2 AG|FA Bc|[1 d D D:| [2 d D D2 |
FA/2A/2 AA|GB/2B/2 BB|FA/2A/2 AF|EA A&gt;G|\
FA df|ge dc|dB AG|FE D2 :|
</code></pre></div></div> <h2 id="data-preparation">Data Preparation</h2> <p>Each data point has different characters length. But are a total of 87 unique characters in for musical representation in every data point. Each unique character has been allocated a numerical index. We’ve developed a dictionary in which the key corresponds to a character and the value is the character’s index. We’ve also made the polar opposite, where the key belongs to the index and the value is the character for ease of recognition.</p> <p><img src="https://user-images.githubusercontent.com/67474080/169769684-acd3fcfa-f3e6-4ba0-9251-b0e24beaeb16.png" alt="unique_chars"></p> <p>Data is fed into batches. We’ll feed a batch of character sequences into our model at once. First, we must create our batches. The following parameters have been set: Batch size = 16 Sequence Length= 64, Input.txt length = 129,665, Number of unique characters = 87 Every batch has got two components, X tensor of size: 16<em>64 and Y tensor of size: 16</em>64*87.</p> <h2 id="model-building">Model Building</h2> <p>The code for model building is available in the repo above. The model buidling process is inspired form the very famous blog of Andrej Karpathy <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/" rel="external nofollow noopener" target="_blank">The Unreasonable Effectiveness of Recurrent Neural Networks</a>. Long Short-Term Memory (LSTM) networks are a type of recurrent neural network capable of learning order dependence in sequence prediction problems. Networks in each recurrent cell learns to control the storage of information through the use of:</p> <p><strong>Forget gate</strong><br> The forget gate determines which data need attention and which can be overlooked. The sigmoid function passes information from the current input X(t) and the hidden state h(t-1). Sigmoid generates values ranging from 0 to 1. It determines if a portion of the previous output is required (by giving the output closer to 1). The cell will utilize this value of f(t) for point-by-point multiplication later.</p> <p><strong>Input gate</strong><br> To update the cell status, the input gate performs the following processes. The second sigmoid function receives the current state X(t) and the previously hidden state h(t-1). The values are changed from 0 to 1 (important) (not-important). The tanh function will then be used to pass the identical information from the hidden and current states. The tanh operator will construct a vector (C(t)) with all the possible values between -1 and 1 to regulate the network. The activation functions generate output values that are ready for point-by-point multiplication.</p> <p><strong>Output gate</strong><br> The value of the next hidden state is determined by the output gate. This state stores data from earlier inputs. The current state and previous concealed state values are first sent to the third sigmoid function. The tanh function is then used to construct a new cell state from the old cell state. These two outputs are multiplied one by one. The network selects which information the concealed state should convey based on the final value. Prediction is based on this concealed state. The new cell state and hidden state are then passed forward to the next time step.</p> <p><strong>Why LSTM?</strong><br> Good for handling long term dependencies in data<br> Quickly adaptable to new data<br> Does not suffer from exploding and vanishing gradients.<br> Language models can be operated at the character level, n-gram level, sentence level or even paragraph level.</p> <p><img src="https://user-images.githubusercontent.com/67474080/169770697-19b3705a-5d30-4074-a691-022bfb633bc5.png" alt="Underlying structure of a single LSTM cell"></p> <p><strong>Underlying structure of a single LSTM cell</strong></p> <p><img src="https://user-images.githubusercontent.com/67474080/169770745-13b5b7de-4c4a-4a22-8c86-3ae29fbb482c.png" alt="Illustration of multiple LSTM cells to form a network"></p> <p><strong>Illustration of multiple LSTM cells to form a network</strong></p> <h2 id="workflow">Workflow</h2> <p>The basic principle in generation of musical notes<br> • select some seed information as the first item (e.g., the first note of a melody);<br> • feedforward it into the recurrent network in order to produce the next item (e.g., next note);<br> • use this next item as the next input to produce the next item; and<br> • repeat this process iteratively until a sequence (e.g., of notes, i.e., a melody) of the desired length is produced.</p> <p>Insert Two figs- underlying stru and mutilple combns</p> <h2 id="dropout-layers">Dropout layers</h2> <p>The Dropout layer, which helps minimize overfitting, sets input units to 0 at random with a rate frequency at each step during training time. Inputs that are not set to 0 are scaled up by 1/(1 - rate) such that the total sum remains unaltered. The Dropout layer only applies when the training parameter is set to True, which means no data are dropped during inference. When using model.fit, training is automatically set to True, and in other cases, you can manually set the kwarg to True when calling the layer.</p> <h2 id="the-softmax-activation-function">The Softmax Activation function</h2> <p>In neural network models that predict a multinomial probability distribution, the softmax function is utilized as the activation function in the output layer. Softmax is utilized as the activation function for multi-class classification issues in which class membership is required to classify characters from one of the 87 mappings.</p> <h2 id="optimizer-and-hyperparameter-tuning">Optimizer and hyperparameter tuning</h2> <p>Standard gradient descent and its variants still face a lot of problems in training deep neural networks in practical solutions which gave rise to an optimizer called Adam. Adam calculates adaptive learning-rates for every parameter which makes it suitable for sparse datasets. It uses momentum which is a concept that reduces oscillations of loss function in unnecessary directions thereby accelerating the convergence towards the relevant direction. In our case the hyperparameters had values 0.9 and 0.999 and value of 0.0001 as learning rate.</p> <h2 id="model-training">Model training</h2> <p>The model was trained on a local PC with an RTX 2070 GPU and the required software. Three basic functions comprise the model training. The first function is batch data reading. The second function is to train the batches in a sequential order, and the third is to build the model in which the batches of data are trained. Our batch size is 16, and the length of the sequence is 64. The total number of batches used is 129665, with each batch containing 8104 data points. The training was initially completed over 100 epochs, with each epoch containing 126 batches. Because numerical values are easy to compute. The character to index and vice versa mapping is done here to make the computation easier since numerical values are flexible to perform complex calculations. The batch size, sequence length, and vocabulary size inputs are passed to the model construct python method. It then uses category cross entropy and the Adam optimizer to assemble the model. There are 256 LSTM layers in total, with a dropout of 0.2 and a model of sequential flow of pattern and softmax activation function. The generated train model weights are kept in a separate model weights file, and checkpointing is conducted to allow the training procedure to resume if the run time is off for various technical reasons. On a high-end system, model training took 2 hours for 100 epochs with 126 batches each. The model was also evaluated on Google Colab’s free version, which took roughly 7 hours.</p> <h2 id="next-character-probability-determination">Next character probability determination</h2> <p><img src="https://user-images.githubusercontent.com/67474080/169771366-f5dda257-23ed-4676-821a-197c27d4734a.png" alt="Next character probability determination"></p> <p><img src="https://user-images.githubusercontent.com/67474080/169771404-3fa474d0-a21d-4c3e-9016-53067b15839b.png" alt="Next char A"><br></p> <p><strong>Therefore, the next character is: A</strong></p> <p><img src="https://user-images.githubusercontent.com/67474080/169771435-20459c1d-61f6-48cf-958b-ae8522a39c3c.png" alt="Next char B">,<br> <strong>Therefore, the next character is: “</strong></p> <p>A limitation of the iterative feedforward strategy on an RNN, is that generation is deterministic. Indeed, a neural network is deterministic . As a consequence, feedforwarding the same input will always produce the same output. As the generation of the next note, the next note, etc., is deterministic, the same seed note will lead to the same generated series of notes .<br> Sampling Fortunately, will solve this issue. The assumption is that the output representation of the melody is one-hot encoded. In other words, the output representation is of abc type with 87 possible characters, the output activation layer is SoftMax and generation is modeled as a classification task.</p> <h2 id="model-metrics">Model metrics</h2> <p><img src="https://user-images.githubusercontent.com/67474080/169775526-6e3e30ba-2ab7-4df2-b38b-3f5e93e0beb8.gif" alt="Epoch vs Accuracy Loss plot"> <img src="https://user-images.githubusercontent.com/67474080/169775546-c47e9d44-ff89-4bce-a365-08025913fde7.png" alt="Testing different optimizers"> <img src="https://user-images.githubusercontent.com/67474080/169775590-8898b3dc-5453-4614-b1f9-0739e0567541.png" alt="Testing different number of LSTM layers"> <img src="https://user-images.githubusercontent.com/67474080/169775604-9dc148b6-150b-4620-9f4d-a33e1ddf4168.png" alt="Testing different number of dropout values"></p> <h2 id="input">Input</h2> <p>As we used RNN technique, the first character for the output can be given. It should be noted that the first character can be random but we can always give freedom to user to choose the first musical character. Moreover, input interface can contain input field to mention the epoch of model to be used for generating the music. As the epoch goes higher the error tends to be lower but takes more computational power. Finally, the length of the piece of music can be manually set. The input interface is similar to below:</p> <p><img src="https://user-images.githubusercontent.com/67474080/169776375-3e9a598a-7a1a-42ba-a153-97a6f7343702.png" alt="Input"></p> <p>Ouput using inbuilt package <img src="https://user-images.githubusercontent.com/67474080/169776417-c8993e45-9528-4fe3-9743-39ee81df8c43.png" alt="Output using inbuilt package"></p> <p>Ouput using external web application abcjs.net <img src="https://user-images.githubusercontent.com/67474080/169776441-d545213f-6422-4bd7-8c5f-06374b615d62.png" alt="Output using abcjs net"></p> <h2 id="references">References</h2> <p>[1]Andrej karpathy. “The Unreasonable Effectiveness of Recurrent Neural Networks”, May 2021<br> [2] J. McCormack, “Grammar based music composition, Complex systems”, Chapter 96, 1996<br> [3] K. Dongwoo, W. Christian, “Computer Assisted Composition with Recurrent Neural Network”, 2018<br> [4] S Madjiheurem, L Qu, C Walder, “Chord2vec: Learning musical chord embeddings - Proceedings of the constructive machine learning”, 2016<br> [5] O. D. Van, A. Dieleman, Z. Sander, S. Heiga, K. Vinyals, A. Graves, N. Kalchabrenner, A. Senior, K. Kavukcuogl, “WaveNet:A Generative Model for Raw Audio, 1609”,2016<br> [6] Payne, Christine. MuseNet: OpenAI, Available at: openai.com/blog/musenet. 25 Apr. 2019<br> [7] C. Dalitz, “ABC User’s Guide Book”, Apr. 2022<br> [8] L. Richardson, Beautiful soup Documentation Release 4.4.0, 24 Dec. 2019</p> </article> </div> </div> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>